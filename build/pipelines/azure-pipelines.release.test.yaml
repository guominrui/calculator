#
# Release
# This pipeline builds a version of the app in a production configuration to be released to the
# Store and the Windows image. This pipeline relies on Microsoft-internal resources to run.
#

trigger:
- master
- release/*
- feature/*
pr: none

name: 0.$(Date:yyMM).$(DayOfMonth)$(Rev:rr).0

jobs:
- template: ./templates/build-app-internal.yaml
  parameters:
    platform: x64
    isPublicRelease: true

- template: ./templates/build-app-internal.yaml
  parameters:
    platform: x86
    isPublicRelease: true
    condition: not(eq(variables['Build.Reason'], 'PullRequest'))

- template: ./templates/build-app-internal.yaml
  parameters:
    platform: ARM
    isPublicRelease: true
    condition: not(eq(variables['Build.Reason'], 'PullRequest'))

- template: ./templates/run-unit-tests.yaml
  parameters:
    platform: x64

- template: ./templates/run-unit-tests.yaml
  parameters:
    platform: x86

- template: ./templates/package-appxbundle.yaml
